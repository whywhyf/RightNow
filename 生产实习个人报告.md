# 生产实习个人报告叶洋帆

叶洋帆

## 任务

主要负责投篮分析

- 命中判定
- 点位图生成
- 数据标注（与张佳安同学共同完成）
- 模型训练（与张佳安同学共同完成）



- 命中判定

  - 记录每一帧篮球和篮筐的位置，若未识别，则保留上一次的位置，根据高度变化，判断是否出手。
  - 识别篮筐的位置，将篮筐及下方锥形区域作为命中判断区，若在此区域检测到篮球，判断该球上一帧位置是否在篮筐之上，若是，则视为命中

- 点位图生成

  - 通过确定球场的固定点在画面中的位置，对画面进行仿射变换，结合出手、命中判断（时间点）和姿态识别（地点），得到画有出手位置，命中与否的出手点位图
  - 由于无法自动识别球场的固定点，为了对任意视频都能进行分析，需要在视频开始时手动确定球场的四个点位。按照左上，左下，右下，右上的顺序点击确定，然后再次点击任意处启动分析
  - ![微信截图_20230720095048](C:\Users\HP\Desktop\things\offterm\court\ba\微信截图_20230720095048.png)
  - O代表命中，+代表未命中
  - ![2023-07-20 (3)](C:\Users\HP\OneDrive\图片\屏幕快照\2023-07-20 (3).png)

- 模型训练

  - 数据集

    使用roboflow平台用公开数据集（约2500张）和自制数据集（约500张），创建具有篮球和篮筐数据标注的训练数据集

  - 训练

    使用yolo库进行训练，使用速度最快的yolov8n模型，能够有效识别篮球和篮筐

  - 模型结果指标

  - ![results](C:\Users\HP\Desktop\things\offterm\court\train\runs\detect\train12\results.png) 

  - | epoch | precision(B) | recall(B) | mAP50(B) | mAP50-95(B) |
    | ----- | ------------ | --------- | -------- | ----------- |
    | 151   | 0.96064      | 0.88955   | 0.93248  | 0.72082     |



## 难点与解决方案

- 模型训练

  - 难点：项目要求能够识别篮球和篮筐的位置，但yolo自带的模型不包括篮球和篮筐

    解决：在roboflow平台使用公开数据集和自己录制的数据集，进行篮球和篮筐的数据标志，再使用该自定义数据集训练模型

- 命中与否的判定

  - 判断命中

    难点：由于数据集和模型能力的限制，球在篮筐和篮板前难以进行识别，无法直接获取球经过篮筐时的位置

    解决：首先识别球筐和篮球的位置，并记录每帧篮球的位置，当篮球出现在篮筐中或者篮筐下方的锥形区域时，判断该球的上一帧的位置，如果在篮筐的上方，则视为命中。

    难点：当篮球以较小角度投入篮筐，容易误判为非命中，

    解决：将篮筐下的竖直识别区域改为锥形识别区域

  - 判定出手

    难点：篮球和人体的运动较为复杂，难以判断篮球是否出手

    解决：使用一个flag，每当flag为True并且篮球高于篮筐，视为出手并将flag赋False，当篮球接近地面时，视为出手结束，并将flag赋True等待下一次出手

- 出手点位图的记录

    难点：球场边界难以通过模型直接识别，且在单一视角下难以直接获取出手点的信息

  解决：通过手动选取视频中图像的固定点位，对原图像进行仿射变换，从而将点位与一般的球场图进行对应，对于每一个出手点都在出手点位图中有相对应的点进行显示

- 难点：当画面中出现多个篮球，容易造成分析的错误

  解决：记录上一帧篮球的位置，在新的一帧中选择所识别篮球中，距离上一帧位置距离最近且不超过一定距离的“篮球”作为认定的篮球，实现简单的物体跟踪



## 收获

在这次生产实习中，我主要负责投篮分析部分，包括命中判定、点位图生成和模型训练。在完成任务的过程中，我遇到了一些挑战，但也找到了相应的解决方案。

首先，模型训练是整个任务的核心，但由于yolo自带的模型不包括篮球和篮筐的识别，我需要自定义数据集并训练模型。我使用了roboflow平台，结合公开数据集和自制数据集，成功训练出了能够识别篮球和篮筐的模型，这是任务中一个重要的突破点。在这一过程中，我学会了如何获取公开的数据集或者创建自己标注的数据集。并在本地或者云端进行模型训练。

其次，命中与否的判定是投篮分析的关键部分。由于数据集和模型的限制，球在篮筐和篮板前难以进行准确识别，因此无法直接获取球经过篮筐时的位置。为了解决这个问题，我采用了记录每帧篮球位置的方法，并根据篮球的高度变化来判断是否出手。通过这种方式，结合篮筐和篮板的位置，成功实现了命中的判定。

在生成点位图的过程中，我遇到了球场边界难以直接识别的问题。为了解决这个问题，我采用了手动选取固定点位的方法，并通过仿射变换将点位与一般的球场图进行对应。这样，每个出手点都能在点位图中有相应的记录，实现了点位图的生成和记录。

在完成任务的过程中，我意识到模型训练和算法实现的重要性，同时也了解到了数据处理和预处理在任务中的关键作用。团队协作也是一个重要的因素，通过与其他成员的配合和讨论，我们能够更好地解决问题和优化方案。

总体而言，这次生产实习让我学到了很多在实际项目中应用的技能和知识。通过不断的尝试和解决问题，我不仅提高了对Python和PyQt的应用能力，还对深度学习模型训练和数据处理有了更深入的了解。我对团队合作的重要性有了更深刻的认识，并且在与团队成员的讨论中，我也学到了很多新的见解和解决问题的思路。这次实习让我在投篮分析领域有了较为全面的了解，也增强了我解决问题和团队合作的能力。通过这次实习，我对未来在计算机视觉和机器学习方向的发展有了更明确的规划和目标。我将继续努力学习，不断提高自己的技能水平，并为将来的工作做好充分准备。